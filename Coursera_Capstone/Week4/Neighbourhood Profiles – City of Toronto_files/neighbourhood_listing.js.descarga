function getParameterByName(t,e){e||(e=window.location.href),t=t.replace(/[\[\]]/g,"\\$&");var o=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)"),a=o.exec(e);return a?a[2]?decodeURIComponent(a[2].replace(/\+/g," ")):"":null}function displayProfile(t,e,o){var a=[],i="";$.each(t.neighbourhoodData,function(t,e){e.id==o&&(a=e.wards,void 0!==e.image&&(i=e.image))});var r=[];$.each(a,function(e,o){var a=t.wardData[parseInt(o.id)-1];a.caption=void 0!==o.caption?o.caption:"",r.push(a)}),neighbourhoodProfile.displayProfile(t.displaySelector,e,o,r,i)}function SortByScore(t,e){return e.score-t.score}!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t("object"==typeof exports?require("jquery"):jQuery)}(function(t){function e(t){return l.raw?t:encodeURIComponent(t)}function o(t){return l.raw?t:decodeURIComponent(t)}function a(t){return e(l.json?JSON.stringify(t):String(t))}function i(t){0===t.indexOf('"')&&(t=t.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return t=decodeURIComponent(t.replace(n," ")),l.json?JSON.parse(t):t}catch(t){}}function r(e,o){var a=l.raw?e:i(e);return t.isFunction(o)?o(a):a}var n=/\+/g,l=t.cookie=function(i,n,s){if(void 0!==n&&!t.isFunction(n)){if(s=t.extend({},l.defaults,s),"number"==typeof s.expires){var c=s.expires,u=s.expires=new Date;u.setTime(+u+864e5*c)}return document.cookie=[e(i),"=",a(n),s.expires?"; expires="+s.expires.toUTCString():"",s.path?"; path="+s.path:"",s.domain?"; domain="+s.domain:"",s.secure?"; secure":""].join("")}for(var d=i?void 0:{},p=document.cookie?document.cookie.split("; "):[],h=0,f=p.length;h<f;h++){var b=p[h].split("="),m=o(b.shift()),g=b.join("=");if(i&&i===m){d=r(g,n);break}i||void 0===(g=r(g))||(d[m]=g)}return d};l.defaults={},t.removeCookie=function(e,o){return void 0!==t.cookie(e)&&(t.cookie(e,"",t.extend({},o,{expires:-1})),!t.cookie(e))}}),function(t){"use strict";function e(){}function o(){try{return document.activeElement}catch(t){}}function a(t,e){for(var o=0,a=t.length;o<a;o++)if(t[o]===e)return!0;return!1}function i(t,e,o){return t.addEventListener?t.addEventListener(e,o,!1):t.attachEvent?t.attachEvent("on"+e,o):void 0}function r(t,e){var o;t.createTextRange?(o=t.createTextRange(),o.move("character",e),o.select()):t.selectionStart&&(t.focus(),t.setSelectionRange(e,e))}function n(t,e){try{return t.type=e,!0}catch(t){return!1}}function l(t,e){if(t&&t.getAttribute(x))e(t);else for(var o,a=t?t.getElementsByTagName("input"):F,i=t?t.getElementsByTagName("textarea"):K,r=a?a.length:0,n=i?i.length:0,l=r+n,s=0;s<l;s++)o=s<r?a[s]:i[s-r],e(o)}function s(t){l(t,u)}function c(t){l(t,d)}function u(t,e){var o=!!e&&t.value!==e,a=t.value===t.getAttribute(x);if((o||a)&&"true"===t.getAttribute(E)){t.removeAttribute(E),t.value=t.value.replace(t.getAttribute(x),""),t.className=t.className.replace(N,"");var i=t.getAttribute(I);parseInt(i,10)>=0&&(t.setAttribute("maxLength",i),t.removeAttribute(I));var r=t.getAttribute(P);return r&&(t.type=r),!0}return!1}function d(t){var e=t.getAttribute(x);if(""===t.value&&e){t.setAttribute(E,"true"),t.value=e,t.className+=" "+A;t.getAttribute(I)||(t.setAttribute(I,t.maxLength),t.removeAttribute("maxLength"));return t.getAttribute(P)?t.type="text":"password"===t.type&&n(t,"text")&&t.setAttribute(P,"password"),!0}return!1}function p(t){return function(){D&&t.value===t.getAttribute(x)&&"true"===t.getAttribute(E)?r(t,0):u(t)}}function h(t){return function(){d(t)}}function f(t){return function(){s(t)}}function b(t){return function(e){if(w=t.value,"true"===t.getAttribute(E)&&w===t.getAttribute(x)&&a(k,e.keyCode))return e.preventDefault&&e.preventDefault(),!1}}function m(t){return function(){u(t,w),""===t.value&&(t.blur(),r(t,0))}}function g(t){return function(){t===o()&&t.value===t.getAttribute(x)&&"true"===t.getAttribute(E)&&r(t,0)}}function v(t){var e=t.form;e&&"string"==typeof e&&(e=document.getElementById(e),e.getAttribute(L)||(i(e,"submit",f(e)),e.setAttribute(L,"true"))),i(t,"focus",p(t)),i(t,"blur",h(t)),D&&(i(t,"keydown",b(t)),i(t,"keyup",m(t)),i(t,"click",g(t))),t.setAttribute(S,"true"),t.setAttribute(x,G),(D||t!==o())&&d(t)}var y=document.createElement("input"),C=void 0!==y.placeholder;if(t.Placeholders={nativeSupport:C,disable:C?e:s,enable:C?e:c},!C){var w,O=["text","search","url","tel","email","password","number","textarea"],k=[27,33,34,35,36,37,38,39,40,8,46],A="placeholdersjs",N=new RegExp("(?:^|\\s)"+A+"(?!\\S)"),x="data-placeholder-value",E="data-placeholder-active",P="data-placeholder-type",L="data-placeholder-submit",S="data-placeholder-bound",I="data-placeholder-maxlength",R=document.getElementsByTagName("head")[0],_=document.documentElement,$=t.Placeholders,F=document.getElementsByTagName("input"),K=document.getElementsByTagName("textarea"),D="false"===_.getAttribute("data-placeholder-focus"),T="false"!==_.getAttribute("data-placeholder-live"),M=document.createElement("style");M.type="text/css";var j=document.createTextNode("."+A+" {color:#ccc;}");M.styleSheet?M.styleSheet.cssText=j.nodeValue:M.appendChild(j),R.insertBefore(M,R.firstChild);for(var G,B,W=0,U=F.length+K.length;W<U;W++)B=W<F.length?F[W]:K[W-F.length],(G=B.attributes.placeholder)&&(G=G.nodeValue)&&a(O,B.type)&&v(B);var H=setInterval(function(){for(var t=0,e=F.length+K.length;t<e;t++)B=t<F.length?F[t]:K[t-F.length],G=B.attributes.placeholder,G?(G=G.nodeValue)&&a(O,B.type)&&(B.getAttribute(S)||v(B),(G!==B.getAttribute(x)||"password"===B.type&&!B.getAttribute(P))&&("password"===B.type&&!B.getAttribute(P)&&n(B,"text")&&B.setAttribute(P,"password"),B.value===B.getAttribute(x)&&(B.value=G),B.setAttribute(x,G))):B.getAttribute(E)&&(u(B),B.removeAttribute(x));T||clearInterval(H)},100);i(t,"beforeunload",function(){$.disable()})}}(this),function(t,e){"use strict";var o=t.fn.val,a=t.fn.prop;e.Placeholders.nativeSupport||(t.fn.val=function(t){var e=o.apply(this,arguments),a=this.eq(0).data("placeholder-value");return void 0===t&&this.eq(0).data("placeholder-active")&&e===a?"":e},t.fn.prop=function(t,e){return void 0===e&&this.eq(0).data("placeholder-active")&&"value"===t?"":a.apply(this,arguments)})}(jQuery,this),function(t,e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?module.exports=e(require("jquery")):t.bootbox=e(t.jQuery)}(this,function t(e,o){"use strict";function a(t){var e=m[f.locale];return e?e[t]:m.en[t]}function i(t,o,a){t.stopPropagation(),t.preventDefault(),e.isFunction(a)&&a.call(o,t)===!1||o.modal("hide")}function r(t){var e,o=0;for(e in t)o++;return o}function n(t,o){var a=0;e.each(t,function(t,e){o(t,e,a++)})}function l(t){var o,a;if("object"!=typeof t)throw new Error("Please supply an object of options");if(!t.message)throw new Error("Please specify a message");return t=e.extend({},f,t),t.buttons||(t.buttons={}),o=t.buttons,a=r(o),n(o,function(t,i,r){if(e.isFunction(i)&&(i=o[t]={callback:i}),"object"!==e.type(i))throw new Error("button with key "+t+" must be an object");i.label||(i.label=t),i.className||(i.className=a<=2&&r===a-1?"btn-primary":"btn-default")}),t}function s(t,e){var o=t.length,a={};if(o<1||o>2)throw new Error("Invalid argument length");return 2===o||"string"==typeof t[0]?(a[e[0]]=t[0],a[e[1]]=t[1]):a=t[0],a}function c(t,o,a){return e.extend(!0,{},t,s(o,a))}function u(t,e,o,a){return p(c({className:"bootbox-"+t,buttons:d.apply(null,e)},a,o),e)}function d(){for(var t={},e=0,o=arguments.length;e<o;e++){var i=arguments[e],r=i.toLowerCase(),n=i.toUpperCase();t[r]={label:a(n)}}return t}function p(t,e){var a={};return n(e,function(t,e){a[e]=!0}),n(t.buttons,function(t){if(a[t]===o)throw new Error("button key "+t+" is not allowed (options are "+e.join("\n")+")")}),t}var h={dialog:"<div class='bootbox modal' tabindex='-1' role='dialog'><div class='modal-dialog'><div class='modal-content'><div class='modal-body'><div class='bootbox-body'></div></div></div></div></div>",header:"<div class='modal-header'><h4 class='modal-title'></h4></div>",footer:"<div class='modal-footer'></div>",closeButton:"<button type='button' class='bootbox-close-button close' data-dismiss='modal' aria-hidden='true'>&times;</button>",form:"<form class='bootbox-form'></form>",inputs:{text:"<input class='bootbox-input bootbox-input-text form-control' autocomplete=off type=text />",textarea:"<textarea class='bootbox-input bootbox-input-textarea form-control'></textarea>",email:"<input class='bootbox-input bootbox-input-email form-control' autocomplete='off' type='email' />",select:"<select class='bootbox-input bootbox-input-select form-control'></select>",checkbox:"<div class='checkbox'><label><input class='bootbox-input bootbox-input-checkbox' type='checkbox' /></label></div>",date:"<input class='bootbox-input bootbox-input-date form-control' autocomplete=off type='date' />",time:"<input class='bootbox-input bootbox-input-time form-control' autocomplete=off type='time' />",number:"<input class='bootbox-input bootbox-input-number form-control' autocomplete=off type='number' />",password:"<input class='bootbox-input bootbox-input-password form-control' autocomplete='off' type='password' />"}},f={locale:"en",backdrop:"static",animate:!0,className:null,closeButton:!0,show:!0,container:"body"},b={};b.alert=function(){var t;if(t=u("alert",["ok"],["message","callback"],arguments),t.callback&&!e.isFunction(t.callback))throw new Error("alert requires callback property to be a function when provided");return t.buttons.ok.callback=t.onEscape=function(){return!e.isFunction(t.callback)||t.callback.call(this)},b.dialog(t)},b.confirm=function(){var t;if(t=u("confirm",["cancel","confirm"],["message","callback"],arguments),t.buttons.cancel.callback=t.onEscape=function(){return t.callback.call(this,!1)},t.buttons.confirm.callback=function(){return t.callback.call(this,!0)},!e.isFunction(t.callback))throw new Error("confirm requires a callback");return b.dialog(t)},b.prompt=function(){var t,a,i,r,l,s,u;if(r=e(h.form),a={className:"bootbox-prompt",buttons:d("cancel","confirm"),value:"",inputType:"text"},t=p(c(a,arguments,["title","callback"]),["cancel","confirm"]),s=t.show===o||t.show,t.message=r,t.buttons.cancel.callback=t.onEscape=function(){return t.callback.call(this,null)},t.buttons.confirm.callback=function(){var o;switch(t.inputType){case"text":case"textarea":case"email":case"select":case"date":case"time":case"number":case"password":o=l.val();break;case"checkbox":var a=l.find("input:checked");o=[],n(a,function(t,a){o.push(e(a).val())})}return t.callback.call(this,o)},t.show=!1,!t.title)throw new Error("prompt requires a title");if(!e.isFunction(t.callback))throw new Error("prompt requires a callback");if(!h.inputs[t.inputType])throw new Error("invalid prompt type");switch(l=e(h.inputs[t.inputType]),t.inputType){case"text":case"textarea":case"email":case"date":case"time":case"number":case"password":l.val(t.value);break;case"select":var f={};if(u=t.inputOptions||[],!e.isArray(u))throw new Error("Please pass an array of input options");if(!u.length)throw new Error("prompt with select requires options");n(u,function(t,a){var i=l;if(a.value===o||a.text===o)throw new Error("given options in wrong format");a.group&&(f[a.group]||(f[a.group]=e("<optgroup/>").attr("label",a.group)),i=f[a.group]),i.append("<option value='"+a.value+"'>"+a.text+"</option>")}),n(f,function(t,e){l.append(e)}),l.val(t.value);break;case"checkbox":var m=e.isArray(t.value)?t.value:[t.value];if(u=t.inputOptions||[],!u.length)throw new Error("prompt with checkbox requires options");if(!u[0].value||!u[0].text)throw new Error("given options in wrong format");l=e("<div/>"),n(u,function(o,a){var i=e(h.inputs[t.inputType]);i.find("input").attr("value",a.value),i.find("label").append(a.text),n(m,function(t,e){e===a.value&&i.find("input").prop("checked",!0)}),l.append(i)})}return t.placeholder&&l.attr("placeholder",t.placeholder),t.pattern&&l.attr("pattern",t.pattern),t.maxlength&&l.attr("maxlength",t.maxlength),r.append(l),r.on("submit",function(t){t.preventDefault(),t.stopPropagation(),i.find(".btn-primary").click()}),i=b.dialog(t),i.off("shown.bs.modal"),i.on("shown.bs.modal",function(){l.focus()}),s===!0&&i.modal("show"),i},b.dialog=function(t){t=l(t);var a=e(h.dialog),r=a.find(".modal-dialog"),s=a.find(".modal-body"),c=t.buttons,u="",d={onEscape:t.onEscape};if(e.fn.modal===o)throw new Error("$.fn.modal is not defined; please double check you have included the Bootstrap JavaScript library. See http://getbootstrap.com/javascript/ for more details.");if(n(c,function(t,e){u+="<button data-bb-handler='"+t+"' type='button' class='btn "+e.className+"'>"+e.label+"</button>",d[t]=e.callback}),s.find(".bootbox-body").html(t.message),t.animate===!0&&a.addClass("fade"),t.className&&a.addClass(t.className),"large"===t.size?r.addClass("modal-lg"):"small"===t.size&&r.addClass("modal-sm"),t.title&&s.before(h.header),t.closeButton){var p=e(h.closeButton);t.title?a.find(".modal-header").prepend(p):p.css("margin-top","-10px").prependTo(s)}return t.title&&a.find(".modal-title").html(t.title),u.length&&(s.after(h.footer),a.find(".modal-footer").html(u)),a.on("hidden.bs.modal",function(t){t.target===this&&a.remove()}),a.on("shown.bs.modal",function(){a.find(".btn-primary:first").focus()}),"static"!==t.backdrop&&a.on("click.dismiss.bs.modal",function(t){a.children(".modal-backdrop").length&&(t.currentTarget=a.children(".modal-backdrop").get(0)),t.target===t.currentTarget&&a.trigger("escape.close.bb")}),a.on("escape.close.bb",function(t){d.onEscape&&i(t,a,d.onEscape)}),a.on("click",".modal-footer button",function(t){var o=e(this).data("bb-handler");i(t,a,d[o])}),a.on("click",".bootbox-close-button",function(t){i(t,a,d.onEscape)}),a.on("keyup",function(t){27===t.which&&a.trigger("escape.close.bb")}),e(t.container).append(a),a.modal({backdrop:!!t.backdrop&&"static",keyboard:!1,show:!1}),t.show&&a.modal("show"),a},b.setDefaults=function(){var t={};2===arguments.length?t[arguments[0]]=arguments[1]:t=arguments[0],e.extend(f,t)},b.hideAll=function(){return e(".bootbox").modal("hide"),b};var m={bg_BG:{OK:"Ок",CANCEL:"Отказ",CONFIRM:"Потвърждавам"},br:{OK:"OK",CANCEL:"Cancelar",CONFIRM:"Sim"},cs:{OK:"OK",CANCEL:"Zrušit",CONFIRM:"Potvrdit"},da:{OK:"OK",CANCEL:"Annuller",CONFIRM:"Accepter"},de:{OK:"OK",CANCEL:"Abbrechen",CONFIRM:"Akzeptieren"},el:{OK:"Εντάξει",CANCEL:"Ακύρωση",CONFIRM:"Επιβεβαίωση"},en:{OK:"OK",CANCEL:"Cancel",CONFIRM:"OK"},es:{OK:"OK",CANCEL:"Cancelar",CONFIRM:"Aceptar"},et:{OK:"OK",CANCEL:"Katkesta",CONFIRM:"OK"},fa:{OK:"قبول",CANCEL:"لغو",CONFIRM:"تایید"},fi:{OK:"OK",CANCEL:"Peruuta",CONFIRM:"OK"},fr:{OK:"OK",CANCEL:"Annuler",CONFIRM:"D'accord"},he:{OK:"אישור",CANCEL:"ביטול",CONFIRM:"אישור"},hu:{OK:"OK",CANCEL:"Mégsem",CONFIRM:"Megerősít"},hr:{OK:"OK",CANCEL:"Odustani",CONFIRM:"Potvrdi"},id:{OK:"OK",CANCEL:"Batal",CONFIRM:"OK"},it:{OK:"OK",CANCEL:"Annulla",CONFIRM:"Conferma"},ja:{OK:"OK",CANCEL:"キャンセル",CONFIRM:"確認"},lt:{OK:"Gerai",CANCEL:"Atšaukti",CONFIRM:"Patvirtinti"},lv:{OK:"Labi",CANCEL:"Atcelt",CONFIRM:"Apstiprināt"},nl:{OK:"OK",CANCEL:"Annuleren",CONFIRM:"Accepteren"},no:{OK:"OK",CANCEL:"Avbryt",CONFIRM:"OK"},pl:{OK:"OK",CANCEL:"Anuluj",CONFIRM:"Potwierdź"},pt:{OK:"OK",CANCEL:"Cancelar",CONFIRM:"Confirmar"},ru:{OK:"OK",CANCEL:"Отмена",CONFIRM:"Применить"},sq:{OK:"OK",CANCEL:"Anulo",CONFIRM:"Prano"},sv:{OK:"OK",CANCEL:"Avbryt",CONFIRM:"OK"},th:{OK:"ตกลง",CANCEL:"ยกเลิก",CONFIRM:"ยืนยัน"},tr:{OK:"Tamam",CANCEL:"İptal",CONFIRM:"Onayla"},zh_CN:{OK:"OK",CANCEL:"取消",CONFIRM:"确认"},zh_TW:{OK:"OK",CANCEL:"取消",CONFIRM:"確認"}};return b.addLocale=function(t,o){return e.each(["OK","CANCEL","CONFIRM"],function(t,e){if(!o[e])throw new Error("Please supply a translation for '"+e+"'")}),m[t]={OK:o.OK,CANCEL:o.CANCEL,CONFIRM:o.CONFIRM},b},b.removeLocale=function(t){return delete m[t],b},b.setLocale=function(t){return b.setDefaults("locale",t)},b.init=function(o){return t(o||e)},b});var CotApp=function(){this.appContentKeySuffix="/"};CotApp.prototype.loadAppContent=function(t){var e={},o=$.extend({keys:[],tag:"",onComplete:function(t){},onProgress:function(t,e,o,a){}},t),a=this;if(o.tag);else{var i=0;o.keys.forEach(function(t){$.ajax({url:"/app_content/"+t+a.appContentKeySuffix,success:function(a){e[t]=a,o.onProgress(t)},error:function(e,a,i){o.onProgress(t,e,a,i)},complete:function(){++i>=o.keys.length&&o.onComplete(e)}})}),0===o.keys.length&&o.onComplete(e)}},$(document).ready(function(){var t=new LocationLookup({gccServer:"https://gis.toronto.ca/arcgis/rest/services/primary/cot_geospatial_webm/MapServer",displaySelector:"#neighbourhoodLookupApp",WARD_CONFIG:"/app_content/ward_data/",NEIGHBOURHOOD_CONFIG:"/app_content/neighbourhood_data/"});t.init().then(function(){t.drawForm();var e=getParameterByName("nbhd");if(null!==e){e.length<2&&(e="0"+e);var o=!1;$.each(t.neighbourhoodData,function(a,i){i.id===e&&($.cookie(t.APP_COOKIE,""),displayProfile(t,i.name,i.id),o=!0)}),o||bootbox.alert("Invalid link. Neighbourhood id ("+e+") is invalid")}})});var LocationLookup=function(t){$.extend(this,{displaySelector:"#appDisplay",codeSelector:"#appCode",resultsDisplaySelector:"#nlResultsDisplay",inputSelector:"#nlSearchLocation",apiWARDURLPrefix:"//map.toronto.ca/geoservices/rest/search/rankedsearch?searchString=",apiWARDURLSuffix:"&searchArea=1&matchType=1&projectionType=1&retRowLimit=10",WARD_CONFIG:"/app_content/ward_data/",NEIGHBOURHOOD_CONFIG:"/app_content/neighbourhood_data/",gccServer:"//gis.toronto.ca/arcgis/rest/services/primary/cot_geospatial_webm/MapServer/"},t||{}),this.APP_COOKIE="neighbourhoodlookup",this.apiNEIGHBOURURL1Prefix=this.gccServer+"/265/query?where=&text=&objectIds=&time=&geometry=",this.apiNEIGHBOURURL2Prefix="//gis.toronto.ca/arcgis/rest/services/secondary/cot_geospatial_webm/MapServer/265/query?where=&text=&objectIds=&time=&geometry=",this.apiNEIGHBOURURLSuffix="&geometryType=esriGeometryPoint&inSR=4326&spatialRel=esriSpatialRelWithin&relationParam=&outFields=AREA_ID%2CAREA_SHORT_CODE%2CAREA_NAME&returnGeometry=false&maxAllowableOffset=&geometryPrecision=&outSR=3857&returnIdsOnly=false&returnCountOnly=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&returnZ=false&returnM=false&gdbVersion=&returnDistinctValues=false&returnTrueCurves=false&resultOffset=&resultRecordCount=&f=pjson",this.results=[],this.wardData={},this.neighbourhoodData={},$(this.displaySelector).on("click","button.btn-wl",$.proxy(function(){$.cookie(this.APP_COOKIE,$(this.inputSelector).val()),this.getData()},this)),$(this.displaySelector).on("click","div.neighbourhood a",$.proxy(function(t){var e=$(t.target);displayProfile(this,e.data("name"),e.data("id")),t.preventDefault()},this))};LocationLookup.prototype.init=function(){var t=$.Deferred();return $.when($.ajax({type:"GET",url:this.WARD_CONFIG,cache:!1,success:$.proxy(function(t){this.wardData=t},this),error:function(){bootbox.alert("An application error has occured. Ward links shown in the results will not work.")}}),$.ajax({type:"GET",url:this.NEIGHBOURHOOD_CONFIG,cache:!1,success:$.proxy(function(t){this.neighbourhoodData=t},this),error:function(){bootbox.alert("An application error has occured. Neighbourhood links shown in the results will not work.")}})).then(function(){t.resolve()}),t},LocationLookup.prototype.drawForm=function(){$(this.displaySelector).html("<div class='row'><div class='col-xs-12 col-md-12'><label for='nlSearchLocation' class='control-label'>Search by Location or Place: </label><div class='input-group'><input type='text' id='nlSearchLocation' class='form-control' placeholder='Type in Address or Place Name'><span class='input-group-addon'><button data-wt_track='no' class='btn btn-primary btn-wl' id='action-button'><span class='glyphicon glyphicon-search' aria-hidden='true'></span> Location Lookup</button></span></div></div></div><div id='nlResultsDisplay' class='clear'></div>"),$("#nlSearchLocation").keydown($.proxy(function(t){13==(t.charCode?t.charCode:t.keyCode?t.keyCode:0)&&($.cookie(this.APP_COOKIE,$(this.inputSelector).val()),this.getData())},this));var t=$.cookie(this.APP_COOKIE);void 0!==t&&""!==t&&($(this.inputSelector).val($.cookie(this.APP_COOKIE)),this.getData())},LocationLookup.prototype.getData=function(){this.results=[],$(this.resultsDisplaySelector).html(""),"undefined"!=typeof dcsMultiTrack&&dcsMultiTrack("WT.ihtml","MT Form: Lookup Address","WT.dl","10","WT.z_url","","WT.z_addr",$.cookie(this.APP_COOKIE));var t=this.apiWARDURLPrefix+$.cookie(this.APP_COOKIE)+this.apiWARDURLSuffix;$.ajax({type:"GET",url:t,ll:this,dataType:"json",error:function(t,e,o){this.ll.processError.call(this.ll,t,e,o)},success:function(t){this.ll.processWardData.call(this.ll,t)}})},LocationLookup.prototype.processWardData=function(t){this.wards=$.merge(t.result.bestResult,$.merge(t.result.likelyResults,t.result.restOfResults)),0===this.wards.length&&(this.results.length=0,this.drawResults()),this.countprocessed=0,this.countrequired=this.wards.length;var e=this;$.each(this.wards,function(t,o){o.complete=$.Deferred(),$.ajax({type:"GET",url:e.apiNEIGHBOURURL1Prefix+o.longitude+"%2C"+o.latitude+e.apiNEIGHBOURURLSuffix,ll:e,llitem:o,dataType:"json",error:function(){$.ajax({type:"GET",url:this.ll.apiNEIGHBOURURL2Prefix+o.longitude+"%2C"+o.latitude+this.ll.apiNEIGHBOURURLSuffix,ll:this.ll,llitem:this.llitem,dataType:"json",error:function(t,e,o){this.ll.processError.call(this,t,e,o)},success:function(t){this.ll.processNeighbourhoodData.call(this,t)}})},success:function(t){this.ll.processNeighbourhoodData.call(this,t)}})})},LocationLookup.prototype.processNeighbourhoodData=function(t){this.ll.countprocessed++;var e={};e.address=this.llitem.key_Desc,e.score=this.llitem.score,e.ward=this.llitem.detail,e.wardlink="",null!==this.llitem.detail.match(/\((\d+)\)/)&&(e.wardId=parseInt(this.llitem.detail.match(/\((\d+)\)/)[1]),e.wardlink=this.ll.wardData[e.wardId-1].link),t.features.length>0&&(e.neighbourhood=t.features[0].attributes.AREA_NAME,e.neighbourhoodId=parseInt(t.features[0].attributes.AREA_NAME.match(/\((\d+)\)/)[1]),e.neighbourhoodName=t.features[0].attributes.AREA_NAME.substring(0,t.features[0].attributes.AREA_NAME.indexOf("(")).trim(),e.neighbourhoodlink=null!=t.features[0].attributes.AREA_NAME.match(/\((\d+)\)/)?this.ll.neighbourhoodData[e.neighbourhoodId]:"",""!=e.wardlink&&""!=e.neighbourhoodlink&&this.ll.results.push(e),this.ll.countprocessed==this.ll.countrequired&&this.ll.drawResults())},LocationLookup.prototype.drawResults=function(){var t="",e="";this.results=this.results.sort(SortByScore);var o=$("body").find("h1,h2,h3,h4,h5,h6,input"),a="",i="";$.each(o,function(t,e){"nlSearchLocation"==e.id&&(a="h"+(parseInt(o[t-1].tagName.toLowerCase().replace("h",""))+1),i="h"+(parseInt(o[t-1].tagName.toLowerCase().replace("h",""))+2))}),""===a&&(a="p"),0===this.results.length?$(this.resultsDisplaySelector).html("<"+a+' aria-live="polite" aria-atomic="true" class="h4 found">No result found for "'+$(this.inputSelector).val()+'". <span class="notfound">Please try again with <i>Street Number</i> and <i>Street Name</i>, or a <i>Place Name</i>. </span></'+a+"><hr>"):$(this.resultsDisplaySelector).html("<"+a+' aria-live="polite" aria-atomic="true" class="h4 found">'+this.results.length+" result"+(1===this.results.length?"":"s")+' found for "'+$(this.inputSelector).val()+'".</'+a+"><hr>"),$.each(this.results,function(o,a){t+='<section class="locationresult">',t+="<"+i+' class="h4 address">'+a.address+"</"+i+">",e=a.ward.substring(a.ward.indexOf("(")+1,a.ward.indexOf(")"))+" - "+a.ward.substring(0,a.ward.indexOf(" (")),t+='<ul><li><div class="ward"> Ward: <a title="Open the ward profile page" href="'+a.wardlink+'">'+e+"</a></div></li>",e=a.neighbourhood.substring(a.neighbourhood.indexOf("(")+1,a.neighbourhood.indexOf(")"))+" - "+a.neighbourhood.substring(0,a.neighbourhood.indexOf(" (")),t+='<li><div class="neighbourhood"> Neighbourhood: <a data-wt_params_m ="WT.event_name='+a.neighbourhoodName+'" title="open the neighbourhood profile page" data-name="'+a.neighbourhoodName+'" data-id="'+a.neighbourhoodId+'" href="#">'+e+"</a>  </div></li></ul>",t+="</section>"}),$(this.resultsDisplaySelector).append(t)},LocationLookup.prototype.processError=function(t,e,o){$(this.resultsDisplaySelector).html(e+" "+o)};var neighbourhoodProfile=function(){"use strict";function t(t,e){var o='<div id="detailModal" class="modal fade printable autoprint" role="dialog">';return o+='<div class="modal-dialog">',o+='<div class="modal-content">',o+='<div class="modal-header">',o+='<div class="row">',o+='<div class="col-xs-12 col-sm-12 col-md-12">',o+='<button type="button" data-wt_track="no" title="Close" data-dismiss="modal" class="close detailClose modalbtn pull-right" ><span aria-hidden="true">&times;</span></button>',o+="</div></div>",o+='<div class="row">',o+='<div class="col-xs-12 col-sm-12 col-md-12 contextTitle">',o+='<h2 id="headerText">'+t+"</h2>",o+="</div></div>",o+="</div>",o+='<div id="modalBody" class="modal-body">',o+='<div id="modalBodyContent">',o+=e,o+="</div>",o+="</div>",o+='<div class="modal-footer">',o+='<button id="detailClose"  data-wt_track="no" type="button" class="btn btn-default detailClose modalbtn" data-dismiss="modal">Close</button>',o+="</div></div></div></div>"}function e(e,o,r,n,l){var s=a+"/2016/pdf1/cpa"+r+".pdf",c=a+"/2011/pdf4/cpa"+r+".pdf",u=a+"/2016/pdf1/alltoronto.pdf",d=a+"/2011/pdf1/alltoronto.pdf",p=a+"/2011/pdf2/alltoronto.pdf",h=a+"/2011/pdf3/alltoronto.pdf",f=a+"/2006/pdf1/cpa"+r+".pdf",b=a+"/2006/pdf2/cpa"+r+".pdf",m=a+"/2006/pdf3/cpa"+r+".pdf",g=a+"/2006/pdf4/cpa"+r+".pdf",v=a+"/2006/pdf5/cpa"+r+".pdf",y=a+"/2001/pdf1/cpa"+r+".pdf",C=a+"/2001/pdf2/cpa"+r+".pdf",w=a+"/2001/pdf3/cpa"+r+".pdf",O=a+"/2001/pdf4/cpa"+r+".pdf",k=a+"/2001/pdf2/all_toronto_full.pdf",A=a+"/2001/pdf3/all_toronto.pdf",N=a+"/2001/pdf4/alltoronto_full.pdf",x='<div id="nbhProfile" class="row">';x+='<div class="col-md-8">',x+="<h2>2016</h2>",x+="<p>Census profile for this neighbourhood, including data on:<br>Age and sex; Type of dwelling; Families, households and marital status; Language; Income; Immigration and ethnocultural diversity; Housing; Education; Labour; and Mobility and migration. </p>",x+="<ul>",x+='<li><a target="_blank" href="'+s+'" title="Neighbourhood Census Profile">Neighbourhood Census Profile</a></li>',x+="</ul>",x+="&nbsp;",x+="<p>Summary city-wide Census profile (all of Toronto)</p>",x+="<ul>",x+='<li><a target="_blank" href="'+u+'" title="Toronto Census Profile">Toronto Census Profile</a></li>',x+="</ul>",x+="<h2>2011</h2>",x+="<p>Census and National Household profile for this neighbourhood, including data on:<br>Age and sex; Type of dwelling; Families, households and marital status; Language; Income; Immigration and ethnocultural diversity; Housing; Education; and Labour</p>",x+="<ul>",x+='<li><a target="_blank" href="'+c+'" title="•\tNeighbourhood Census/NHS Profile">Neighbourhood Census/NHS Profile)</a></li>',x+="</ul>",x+="&nbsp;",x+="<p>Summary city-wide profiles (all of Toronto)</p>",x+="<ul>",x+='<li><a target="_blank" href="'+d+'" title="Social Profile #1 - Age and Gender">Social Profile #1 - Age and Gender (PDF)</a></li>',x+='<li><a target="_blank" href="'+p+'" title="Social Profile #2 - Language">Social Profile #2 - Language (PDF)</a></li>',x+='<li><a target="_blank" href="'+h+'" title="Social Profile #3 - Family and Dwellings">Social Profile #3 - Family and Dwellings (PDF)</a></li>',x+="</ul>",x+="<h2>2006</h2>",x+="<p>Profiles for this neighbourhood</p>",x+="<ul>",x+='<li><a target="_blank" href="'+f+'" title="Social Profile #1 - Age and Gender">Social Profile #1 - Age and Gender (PDF)</a></li>',x+='<li><a target="_blank" href="'+b+'" title="Social Profile #2 - Language">Social Profile #2 - Language (PDF)</a></li>',x+='<li><a target="_blank" href="'+m+'" title="Social Profile #3 - Family and Dwellings">Social Profile #3 - Family and Dwellings (PDF)</a></li>',x+='<li><a target="_blank" href="'+g+'" title="Social Profile #4 - Income & Poverty">Social Profile #3 - Income & Poverty (PDF)</a></li>',x+='<li><a target="_blank" href="'+v+'" title="Social Profile #5 - Youth">Social Profile #3 - Youth (PDF)</a></li>',x+="</ul>",x+="<h2>2001</h2>",x+="<p>Profiles for this neighbourhood</p>",x+="<ul>",x+='<li><a target="_blank" href="'+y+'" title="Social Profile #1 - Age and Gender">Social Profile #1 - Age and Gender (PDF)</a></li>',x+='<li><a target="_blank" href="'+C+'" title="Social Profile #2 - Immingration, Ethnicity and Language">Social Profile #2 - Immigration, Ethnicity and Language (PDF)</a></li>',x+='<li><a target="_blank" href="'+w+'" title="Social Profile #3 - Households and Income">Social Profile #3 - Households and Income (PDF)</a></li>',x+='<li><a target="_blank" href="'+O+'" title="Social Profile #4 - Youth">Social Profile #3 - Youth (PDF)</a></li>',x+="</ul>",x+="<p>Summary city-wide profiles (all of Toronto)</p>",x+="<ul>",x+='<li><a target="_blank" href="'+k+'" title="Social Profile #2">Social Profile #2 (PDF)</a></li>',x+='<li><a target="_blank" href="'+A+'" title="Social Profile #3">Social Profile #3 (PDF)</a></li>',x+='<li><a target="_blank" href="'+N+'" title="Social Profile #4">Social Profile #4 (PDF)</a></li>',x+="</ul>",x+="</div>",x+='<div class="col-md-4 right">',""!==l&&(x+="<h2>Neighbourhood Map</h2>",x+='<img alt="Neighbourhood '+r+'" height="341" src="'+i+l+'" title="Neighbourhood '+r+'" width="200">'),n.length>0&&(x+="<h3>Wards</h3>"),$.each(n,function(t,e){x+="<a target='_blank' class='wardlink' href='"+e.link+"' >"+e.id+" - "+(""!==e.caption?e.caption:e.name)+"</a>"}),x+="</div>",x+="</div>",$("#detailModal").remove(),$(footer).after(t(o,x));var E=$("#detailModal");E.modal("show"),E.on("shown.bs.modal",function(){$("#main").addClass("hidden-print"),$(this).find(".modal-header button").focus()}),E.find(".modal-header button").on("keydown",function(t){if(9===(t.which||t.keyCode)&&t.shiftKey)return E.find(".modal-footer button").focus(),!1}),E.find(".modal-footer button").on("keydown",function(t){if(9===(t.which||t.keyCode)&&!t.shiftKey)return E.find(".modal-header button").focus(),!1}),E.on("hidden.bs.modal",function(){return"undefined"!=typeof dcsMultiTrack&&dcsMultiTrack("WT.ihtml","Modal Close","WT.event_name","","WT.dl","26","WT.z_url","","WT.nv",""),$("#main").removeClass("hidden-print"),!1}),$("#nbhProfile").on("click",".goback",function(t){$(e).removeClass("hidden"),$("#nbhProfile").html(""),t.preventDefault()})}var o={},a="/ext/sdfa/Neighbourhood%20Profiles/pdf",i="/ext/sdfa/Neighbourhood%20Profiles/images/";return o.displayProfile=e,o}();!function(){function t(){$('a[data-toggle="tab"]').on("shown.bs.tab",function(t){$(l+" .apptab").addClass("hidden"),$($(t.target).attr("href")).removeClass("hidden")}),$(l).on("click",".listingtab a",function(t){var o=$(t.target);e(l,o.data("name"),o.data("id")),t.preventDefault()}),$(l).on("click","area",function(t){var o=$(t.target);"undefined"!=typeof dcsMultiTrack&&dcsMultiTrack("WT.event_name",o.attr("alt"),"WT.dl","21","WT.nv","map"),$.each(u,function(t,a){a.id==o.data("id")&&e(l,a.name,o.data("id"))}),t.preventDefault()})}function e(t,e,o){var a=[],i="";$.each(u,function(t,e){e.id==o&&(a=e.wards,void 0!==e.image&&(i=e.image))});var r=[];$.each(a,function(t,e){var o=d[parseInt(e.id)-1];o.caption=void 0!==e.caption?e.caption:"",r.push(o)}),neighbourhoodProfile.displayProfile(t,e,o,r,i)}function o(){sortedList=u.sort(function(t,e){return t.name.localeCompare(e.name)});var t="<table class='listingtab table table-responsive table-striped table-hover'><thead><tr ><td >Hood #</td><td>Neighbourhood Name</td></tr></thead>";$.each(sortedList,function(e,o){t+="<tr><td>"+parseInt(o.id)+'</td><td><a data-wt_params_m ="WT.event_name='+o.name+'" href="#" data-name="'+o.name+'" data-id="'+o.id+'">'+o.name+"</a></td></tr>"}),t+="</table>",$("#neighbourhoodListAlpha").html(t)}function a(){var t="<table class='listingtab table table-striped table-hover'><thead><tr><td>Hood #</td><td>Neighbourhood Name</td></tr></thead>";$.each(u,function(e,o){
t+="<tr><td>"+parseInt(o.id)+'</td><td><a data-wt_params_m ="WT.event_name='+o.name+'" href="#" data-name="'+o.name+'" data-id="'+o.id+'">'+o.name+"</a></td></tr>"}),t+="</table>",$("#neighbourhoodListNumeric").html(t)}function i(){$.each(u,function(t,e){$('area[data-id="'+e.id+'"]').attr("title",e.id+": "+e.name)})}function r(){t(),a(),o(),i()}function n(){$.when($.ajax({type:"GET",url:c,cache:!1,success:function(t){d=t},error:function(){bootbox.alert("An application error has occured. Ward links shown in the results will not work.")}}),$.ajax({type:"GET",url:s,cache:!1,success:function(t){u=t},error:function(){bootbox.alert("An application error has occured. Neighbourhood links shown in the results will not work.")}})).then(function(){r()})}var l="#neighbourhoodApp",s="/app_content/neighbourhood_data/",c="/app_content/ward_data/",u=[],d=[];$(document).ready(function(){n()})}();