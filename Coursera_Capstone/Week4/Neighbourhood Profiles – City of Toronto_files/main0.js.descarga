function _classCallCheck(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function waitForElement(){if(void 0!==WPFeedback&&document.getElementById("wp-feedback_container")){new WPFeedback("wp-feedback").render()}else setTimeout(waitForElement,500)};var _createClass=function(){function t(t,n){for(var r=0;r<n.length;r++){var e=n[r];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}return function(n,r,e){return r&&t(n.prototype,r),e&&t(n,e),n}}(),WPFeedback=function(){function t(n){_classCallCheck(this,t),this.$container="#"+n+"_container"}return _createClass(t,[{key:"render",value:function(){$(".form-messages",this.$container).children().hide(),$(".form-invalid",this.$container).hide(),this.bindEvents()}},{key:"bindEvents",value:function(){$(".radio .image").on("click",function(t){$(this).parent().parent().children("input").first().trigger("click")}),$(".radio input",this.$container).on("keyup",function(t){t.stopPropagation(),32!=t.keyCode&&" "!=t.key||$(this).parent().trigger("click")}),$(".radio input").on("change",function(t){$(this).attr("checked",!0),$(this).is(":checked")&&($("#levels legend").removeClass("invalid"),$(".form-invalid",this.$container).hide(),$(this).parent().siblings(".radio").removeClass("selected").children("input").attr("aria-checked",!1).attr("checked",!1),$(this).attr("aria-checked",!0).parent().addClass("selected"))}),$(".checkbox input",this.$container).on("change",function(t){var n=$(this).is(":checked");$(this).attr("aria-checked",n)}),$(".radio .label").on("click",function(t){$(t.target).parent().prev().trigger("focus")}),$("input",this.$container).on("focus",function(t){"radio"==t.target.type&&$(this).parent().addClass("focused"),"checkbox"==t.target.type&&$(this).parent("label").addClass("focused")}),$("input",this.$container).on("blur",function(t){"radio"==t.target.type&&$(this).parent().removeClass("focused"),"checkbox"==t.target.type&&$(this).parent("label").removeClass("focused")}),$("#levels input",this.$container).on("invalid",function(t){"invalid"==t.type&&this.showValidationError(t)}.bind(this)),$("form",this.$container).on("submit",function(t){$("button[type=submit]",this.$container).prop("disabled",!0),$(".form-invalid",this.$container).hide(),$(".form-messages").children().hide().html("");var n=this.formData(t.target);$.ajax({url:"https://secure.toronto.ca/c3api_data/v2/DataAccess.svc/wp_feedback/feedback/ca.toronto.api.dataaccess.odata4.submit",method:"POST",contentType:"application/json",data:JSON.stringify(n),success:this.formSuccess.bind(this),error:this.formError.bind(this)}),t.preventDefault()}.bind(this))}},{key:"showValidationError",value:function(t){t.preventDefault(),$("#levels legend").addClass("invalid"),$(".form-invalid",this.$container).show(),$("#levels input[type=radio]").first().trigger("focus")}},{key:"formSuccess",value:function(t){$.ajax({url:"https://www.toronto.ca/app_content/wp_feedback/",method:"GET",success:function(n){var r='<h2 class="text-capitalize" style="padding-bottom: 10px; font-size: 1.25em; padding-left: 0px; padding-right: 0px;">'+n.title+"</h2>";r+="<p>"+n.message,t.other?(r+=" "+n.other+"</p>",r+="<small>"+n.policy+"</small>"):r+="</p>",$(".form-wrapper",this.$container).detach(),$(".form-messages .form-success",this.$container).html(r).fadeIn()}})}},{key:"formError",value:function(t,n,r){$(".form-messages .form-error",this.$container).html("There was an error processing your request.").fadeIn(),$("button[type=submit]",this.$container).prop("disabled",!1)}},{key:"formData",value:function(t){var n={};return n.path=window.location.pathname,n.issues=[],$.each($(t).serializeArray(),function(t,r){var e=r.name,i=r.value;"level"==e&&(n.level=i),"issues"==e&&n.issues.push(i)}),n}}]),t}();waitForElement();
